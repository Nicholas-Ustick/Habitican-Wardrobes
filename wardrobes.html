<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>habitican Wardrobes</title>
    <meta name="description" content="Wardrobes for Heros of Habitica" />
    <meta name="author" content="@Piti! Code is based on Alys (Alice Harris) lady_alys@oldgods.net code from Data Display Tool" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	
	
	
<script type="text/javascript">

$(function() { // wraps around all our code to not pollute global namespace

//////////////////////////////////////////////////////////////////////
////   Global Variables                              /////////////////
//////////////////////////////////////////////////////////////////////



var content = {}; // Habitica's content
var user = {}; // holds user content
var tasksFromDb = {}; // holds tasks
var serverUrl = 'https://habitica.com:443/api/v3';
var userID     = '';
var apiToken   = '';
var legendary = {"head":"head_special_2", "armor":"armor_special_2", "weapon":"weapon_special_2","shield":"shield_special_goldenknight"}; // Nameless Helm, Jean Chalard's Noble Tunic, Stephen Weber's Shaft of the Dragon, Mustaine's Milestonemashing Morningstar
var blessing = {};
var intelligence = {};
var perception = {};
var constitution = {};
var strength = {};
var initialGear = {};
var amountOfSkill = 0; 
var rememberGear = "true"; // use string (required by localStorage)
var hardMode = "false"; // use string (required by localStorage) 
var frontEnd = "skills"; // for toggling between "wardrobes" and "skills" / later get content from localstorage
var legendaryGearOwned = false; // see function checkLegendaryGear
var wardrobeEquipped = ['Initial'];
var userName = '';
var equipCount = 0;
var equipCountSkip = 0;
var nameOfWardrobe = 'perception'; 
var gearLocation = ["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"]; 
var attributes = ["int", "per", "str", "con"];
var maxInt = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
var maxPer = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
var maxStr = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
var maxCon = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
var maxBles = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
var skills = {"rogue": {
				"field1": {
					"name": "Tools of the Trade", 
                    "API": "https://habitica.com/api/v4/user/class/cast/toolsOfTrade",
                    "cost": 25, 
					"nameOfWardrobe": "Perception",
					"unlock": 13,  
					"wardrobe": "perception"   // will be replaced by wardrobe-object
					},
				"field2": {
					"name": "Stealth", 
                    "API": "https://habitica.com/api/v4/user/class/cast/stealth",
                    "cost": 45, 
					"nameOfWardrobe": "Perception",
					"unlock": 14,
					"wardrobe": "perception" },
				"field3": {
					"name": "Pickpocket", 
                    "API": "https://habitica.com/api/v4/user/class/cast/pickPocket",
                    "cost": 10, 
					"nameOfWardrobe": "Perception",
					"wardrobe": "perception",
					"unlock": 11, 
					"task": "pending",  // will be replaced by evaluateTaksks();
					"taskId": "pending"},
				"field4": {
					"name": "Backstab", 
                    "API": "https://habitica.com/api/v4/user/class/cast/backStab",
                    "cost": 15, 
					"nameOfWardrobe": "Strength",
					"wardrobe": "strength",
					"unlock": 12, 
					"task": "pending",
					"taskId": "pending" }	
				},
			  "wizard": {
				"field1": {
					"name": "Earthquake", 
                    "API": "https://habitica.com/api/v4/user/class/cast/earth",
                    "cost": 35, 
					"nameOfWardrobe": "Intelligence",
					"unlock": 13, 
					"wardrobe": "intelligence" },
				"field2": {
					"name": "Burst of Flames", 
                    "API": "https://habitica.com/api/v4/user/class/cast/fireball",
                    "cost": 10, 
					"nameOfWardrobe": "Intelligence",
					"wardrobe": "intelligence",
					"unlock": 11, 
					"task": "pending",
					"taskId": "pending" 
					},
				"field3": {
					"name": "Ethereal Surge", 
                    "API": "https://habitica.com/api/v4/user/class/cast/mpheal",
                    "cost": 30, 
					"nameOfWardrobe": "Intelligence",
					"unlock": 12, 
					"wardrobe": "intelligence"
					},
				"field4": {
					"name": "Chilling Frost", 
                    "API": "https://habitica.com/api/v4/user/class/cast/frost",
                    "cost": 40, 
					"nameOfWardrobe": "Intelligence",
					"unlock": 14, 
					"wardrobe": "intelligence" }	
				}, 
			  "warrior": {
				"field1": {
					"name": "Valorous Presence", 
                    "API": "https://habitica.com/api/v4/user/class/cast/valorousPresence",
                    "cost": 20, 
					"nameOfWardrobe": "Strength",
					"unlock": 13, 
					"wardrobe": "strength" },
				"field2": {
					"name": "Brutal Smash", 
                    "API": "https://habitica.com/api/v4/user/class/cast/smash",
                    "cost": 10, 
					"nameOfWardrobe": "Strength",
					"wardrobe": "strength",
					"unlock": 11, 
					"task": "pending",
					"taskId": "pending" },
				"field3": {
					"name": "Intimidating Gaze", 
                    "API": "https://habitica.com/api/v4/user/class/cast/intimidate",
                    "cost": 15, 
					"nameOfWardrobe": "Constitution",
					"unlock": 14, 
					"wardrobe": "constitution" },
				"field4": {
					"name": "Defensive Stance", 
                    "API": "https://habitica.com/api/v4/user/class/cast/defensiveStance",
                    "cost": 25, 
					"nameOfWardrobe": "Constitution",
					"unlock": 12, 
					"wardrobe": "constitution" }	
				},
			  "healer": {
				"field1": {
					"name": "Protective Aura", 
                    "API": "https://habitica.com/api/v4/user/class/cast/protectAura",
                    "cost": 15, 
					"nameOfWardrobe": "Blessing",
					"unlock": 13, 
					"wardrobe": "blessing" },
				"field2": {
					"name": "Searing Brightness", 
                    "API": "https://habitica.com/api/v4/user/class/cast/brightness",
                    "cost": 15, 
					"nameOfWardrobe": "Constitution",
					"unlock": 12, 
					"wardrobe": "constitution" },
				"field3": {
					"name": "Blessing", 
                    "API": "https://habitica.com/api/v4/user/class/cast/healAll",
                    "cost": 25, 
					"nameOfWardrobe": "Blessing",
					"unlock": 14, 
					"wardrobe": "blessing" },
				"field4": {
					"name": "Healing Light", 
                    "API": "https://habitica.com/api/v4/user/class/cast/heal",
                    "cost": 15, 
					"nameOfWardrobe": "Blessing",
					"unlock": 11, 
					"wardrobe": "blessing" }	
				}
			};		//end skill...
			

//////////////////////////////////////////////////////////////////////
////   Get UUID from URL      ////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
var url_vars = getUrlVars();
if (url_vars.uuid) {
    $("#userId").val(url_vars.uuid);
}
function getUrlVars() {
    // Function found at http://stackoverflow.com/questions/4656843/jquery-get-querystring-from-url#answer-4656873
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}

//////////////////////////////////////////////////////////////////////
////   Login events      /////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
$('#userApiDetailsForm').submit(function(event){
    /* The user manually submitted the API connection form. */

    userID   = $('#userId').val();
    apiToken = $('#apiToken').val();
    fetchData();
});




//////////////////////////////////////////////////////////////////////
//// LocalStorage with Fallback to cookies ///////////////////////////
//////////////////////////////////////////////////////////////////////


var storeData = function storeData(key, value) {

    var lsSupport = false;
    // Check for native support
		lsSupport = (function() {
			try {
				localStorage.setItem("Test", "Test");
				localStorage.removeItem("Test");
				return true;
			} catch (exception) {
				return false;
			}
		}());


    
    // If value is detected, set new or modify store
    if (typeof value !== "undefined" && value !== null) {
        // Convert object values to JSON
        if ( typeof value === 'object' ) {
            value = JSON.stringify(value);
        }
        if (lsSupport) { 
            localStorage.setItem(key, "" + value);
        } else { // Use Cookie
            createCookie(key, value, 30);
        }
    }

    // No value supplied, return value
    if (typeof value === "undefined") {
        // Get value
        var data = null; 
		if (lsSupport) { // Native support
            data = localStorage.getItem(key);
        } else { // Use cookie 
            data = readCookie(key);
        }

        

        // Try to parse JSON...
        try {
           data = JSON.parse(data);
        }
        catch(e) {
           data = data;
        }
		if (data != null){
			data = "" + data; 
		}
        return data;
    }

    // Null specified, remove store

    if (value === null) {
        if (lsSupport) { // Native support
            localStorage.removeItem(key);
        } else { // Use cookie
            createCookie(key, '', -1);
        }
    }
   

    /**
     * Creates new cookie or removes cookie with negative expiration
     * @param  key       The key or identifier for the store
     * @param  value     Contents of the store
     * @param  exp       Expiration - creation defaults to 30 days
     */

    function createCookie(key, value, exp) {
        var date = new Date();
        date.setTime(date.getTime() + (exp * 24 * 60 * 60 * 1000));
        var expires = "; expires=" + date.toGMTString();
        document.cookie = key + "=" + value + expires + "; path=/";
    }
    /**
     * Returns contents of cookie
     * @param  key       The key or identifier for the store
     */

    function readCookie(key) {
        var nameEQ = key + "=";
        var ca = document.cookie.split(';');
        for (var i = 0, max = ca.length; i < max; i++) {
            var c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
};








//////////////////////////////////////////////////////////////////////
////   Data Fetch Function   /////////////////////////////////////////
//////////////////////////////////////////////////////////////////////

function fetchData() {
    $('#loading .bad' ).hide();
	$('#modalContent').html('Please wait, fetching data from Habitica... 1/3');
	$('#modal').show();

    var ajaxRunningCount = 3; // drops to 0 when all calls have succeeded
    // fetch the site-wide content (gear names and stats, etc):
    $.ajax({
        url: serverUrl + '/content',
        type: 'GET',
        dataType: 'json',
        cache: true,
        success: fetchContentSuccess,
        error: fetchFailure
    });

	// fetch the tasks content (dotods dailies etc):
    $.ajax({
        url: serverUrl + '/tasks/user',
        type: 'GET',
        dataType: 'json',
        cache: true,
		 beforeSend: function(xhr){
		 		xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
                xhr.setRequestHeader('x-api-user', userID);
                xhr.setRequestHeader('x-api-key',  apiToken);
            },
        success: fetchTasksSuccess,
        error: fetchFailure
    });

    // fetch the user's own content (gear owned, etc):
	$.ajax({
        url: serverUrl + '/user',
        type: 'GET',
        dataType: 'json',
        cache: false,
        beforeSend: function(xhr){
				xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
                xhr.setRequestHeader('x-api-user', userID);
                xhr.setRequestHeader('x-api-key',  apiToken);
            },
        success: fetchUserSuccess,
        error: fetchFailure
        });

    function fetchFailure() {
        $('#modal').hide();
        $('#loading .bad' ).show();
    }

    function fetchContentSuccess(data) {
        content = data.data;
        ajaxRunningCount--;
		if (ajaxRunningCount === 1) {$('#modalContent').html('Please wait, fetching data from Habitica... 3/3');}
		if (ajaxRunningCount === 2) {$('#modalContent').html('Please wait, fetching data from Habitica... 2/3');}
        if (ajaxRunningCount === 0) {  // all ajax calls have finished
            $('#modal').hide();
			parseData();
        }
    }

    function fetchUserSuccess(data) {
        user = data.data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 1) {$('#modalContent').html('Please wait, fetching data from Habitica... 3/3');}
		if (ajaxRunningCount === 2) {$('#modalContent').html('Please wait, fetching data from Habitica... 2/3');}
		if (ajaxRunningCount === 0) { // all ajax calls have finished
            $('#modal').hide();
			parseData();
        }
    }

	function fetchTasksSuccess(data) {
        tasksFromDb = data.data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 1) {$('#modalContent').html('Please wait, fetching data from Habitica... 3/3');}
		if (ajaxRunningCount === 2) {$('#modalContent').html('Please wait, fetching data from Habitica... 2/3');}
        if (ajaxRunningCount === 0) { // all ajax calls have finished
            $('#modal').hide();
			parseData();
        }
    }

} // end of fetchData() //////////////////////////////////////////////



//////////////////////////////////////////////////////////////////////
////   Parse Data Function   /////////////////////////////////////////
//////////////////////////////////////////////////////////////////////

function parseData() {
    var htmlStats = ''; // displaying name, class, current equipment, int, per, str, con
	var htmlStart = '';
    var html = '';
	var htmlEnd = '';
	var int = 0;
	var per = 0;
	var str = 0;
	var con = 0;
	var dailyTotal = 0;
	var dailyTotalStealth = 0; 
	var dailyCompleted = 0;
	//var wardrobeEquipped = ["Initial"];
	var mostValueableTaskValue = 0;
	var mostValueableTaskName = "";  
	

function getFirstLocalStorage() {	
	//front End (wardrobes and skills)
	var frontEnd = storeData("FrontEnd"); 
		if (frontEnd == null) {
		 	frontEnd = "wardrobes"; 
			storeData("FrontEnd", "wardrobes"); // set FrontEnd to "wardrobes" on first time opening code in browser
			$('.skills-Container').hide(); 
			}
		if (frontEnd == "wardrobes") {
			$('.skills-Container').hide();
			}
		if (frontEnd == "skills") {
			$('.wardrobes-Container').hide();
			}
			
	rememberGear = storeData("Remember Gear"); 
			if (rememberGear == "true") {$("#rememberGear").prop('checked', true);}
			if (rememberGear == null) {
				rememberGear = "true"; 
				storeData("Remember Gear", "true"); 
				$('#rememberGear').prop('checked', true);  
			}
	
	
	} // end of funciton getFirstLocalStorage
	
	
	function evaluateTasks() {
		// get bluest Task for (Burst of Flames(Mage))   // challenge {}: Skill can only be cast on non-challenge tasks, but on habits, dailies and todos
		var bluestTaskId = ""; 
		var bluestTaskValue = 0;
		var bluestTaskName = "";  
		for (var i in tasksFromDb){ 
			if (jQuery.isEmptyObject(tasksFromDb[i].challenge)) {
				if (bluestTaskValue < tasksFromDb[i].value) {
					bluestTaskValue = tasksFromDb[i].value; 
					bluestTaskId = tasksFromDb[i].id
					bluestTaskName = tasksFromDb[i].text; 		
				}
				} 
			} // end for var i in tasksFromDb
		skills.wizard.field2.task = bluestTaskName; 
		skills.wizard.field2.taskId = bluestTaskId; 
		skills.rogue.field3.task = bluestTaskName; 
		skills.rogue.field3.taskId = bluestTaskId; 
		skills.rogue.field4.task = bluestTaskName; 
		skills.rogue.field4.taskId = bluestTaskId; 
		skills.warrior.field2.task = bluestTaskName; 
		skills.warrior.field2.taskId = bluestTaskId; 
		
		
		for (var i in tasksFromDb) { 
			if (tasksFromDb[i].type == 'habit') {
				if (mostValueableTaskValue < tasksFromDb[i].value) {
					mostValueableTaskValue = tasksFromDb[i].value; 
					mostValueableTaskName = tasksFromDb[i].text; 
				}
       			} // endIf daily or habit
			if (tasksFromDb[i].type == 'daily') {
				dailyTotalStealth++; 
				if (tasksFromDb[i].isDue == true) {
					dailyTotal ++;
					}
				if (tasksFromDb[i].completed == true) {
					dailyCompleted ++;
					}	
				} // end if daily
		}; // end for
	}; // end of function evaluateTasks;


	function checkLegendaryGear() {
		var ownedGear = user.items.gear.owned;
		if (ownedGear["head_special_2"] == true && 
			ownedGear["armor_special_2"] == true && 
			ownedGear["weapon_special_2"] == true && 
			ownedGear["shield_special_goldenknight"] == true) {
			legendaryGearOwned = true;
		} else {
			legendaryGearOwned = false; 
		}
	}; // end of function checkLegendaryGear

	
	function getMaxGear() {
		// hard mode button
		hardMode = storeData("Hard Mode"); 
			if (hardMode == "true") {$("#hardMode").prop('checked', true);}
			if (hardMode == null) {
				hardMode = "false"; 
				storeData("Hard Mode", "false"); 
				$('#hardMode').prop('checked', false);  
			}
		var ownedKeys = {}; 
		var ownedGear = user.items.gear.owned; // Format: "nameOfEquipment": boolean,   // user.items.gear.owned = false might occur when item was owned once but lost due to death. Still to be implemted	 
	
		// get rid of inventory lost due to death or character reset... 
		for (var item in ownedGear){
			if (ownedGear[item] === false) {delete ownedGear[item];} 
			}
		
		// get initial Gear and save to var
		initialGear.weapon = user.items.gear.equipped.weapon;  
		initialGear.shield = user.items.gear.equipped.shield;  
		initialGear.armor = user.items.gear.equipped.armor;  
		initialGear.head = user.items.gear.equipped.head;  
		initialGear.headAccessory = user.items.gear.equipped.headAccessory;  
		initialGear.back = user.items.gear.equipped.back;  
		initialGear.body = user.items.gear.equipped.body;  
		initialGear.eyewear = user.items.gear.equipped.eyewear;  
		
		
		for (var item in ownedGear){ // var item: Format: nameOfEquipment
			ownedKeys[item] = content.gear.flat[item]; // Habiticas content information about each key
				
				// INT
				var factor = 1; 
				if (ownedKeys[item].klass == user.stats.class) {var factor = 1.5;} 
				for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
					var gear = gearLocation[i];  // fromat gear: head_base_0 e.g.
					if ((factor * ownedKeys[item].int) >= maxInt[gear] && ownedKeys[item].type == gear && ownedKeys[item].twoHanded != true) {
						intelligence[gear] = ownedKeys[item].key; 
						maxInt[gear] = (factor * ownedKeys[item].int);
					} // end if  
				} // end for var i in gearLocation
				// Hardmode?
				if (document.getElementById("hardMode").checked === false) {
					if (maxInt["headAccessory"] <= 2 && ownedGear["headAccessory_armoire_comicalArrow"] == true) {intelligence["headAccessory"] = "headAccessory_armoire_comicalArrow"; }
					if (maxInt["back"] <= 2 && ownedGear["back_special_aetherCloak"] == true) {intelligence["back"] = "back_special_aetherCloak";}
					if (maxInt["body"] <= 2 && ownedGear["body_special_aetherAmulet"] == true) {intelligence["body"] = "body_special_aetherAmulet";}
				} // end if hardMode
				
				// PER
				var factor = 1; 
				if (ownedKeys[item].klass == user.stats.class) {var factor =1.5;}
				for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
       		 		var gear = gearLocation[i];
					if ((factor * ownedKeys[item].per) >= maxPer[gear] && ownedKeys[item].type == gear && ownedKeys[item].twoHanded != true) {
						perception[gear] = ownedKeys[item].key; 
						maxPer[gear] = (factor * ownedKeys[item].per);
					}  // end if ownedGear[item]
				} // end for var i in gearLocation

				// CON
				var factor = 1; 
				if (ownedKeys[item].klass ==user.stats.class ) {var factor = 1.5;}
				for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
       	 			var gear = gearLocation[i];
					if ((factor * ownedKeys[item].con) >= maxCon[gear] && ownedKeys[item].type == gear && ownedKeys[item].twoHanded != true) {
						constitution[gear] = ownedKeys[item].key; 
						maxCon[gear] = (factor * ownedKeys[item].con);
					}  // end if
				} // end for var in gearLocation 
		
				// STR
				var factor = 1;
				if (ownedKeys[item].klass == user.stats.class) {var factor = 1.5;}
				for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
       		 		var gear = gearLocation[i];
					if ((factor * ownedKeys[item].str) >= maxStr[gear] && ownedKeys[item].type == gear && ownedKeys[item].twoHanded != true) {
						strength[gear] = ownedKeys[item].key; 
						maxStr[gear] = (factor * ownedKeys[item].str);
					}  // end if
				} // end for var i in gearLocation
				//Hardmode?
				if (document.getElementById("hardMode").checked === false) {
					if (maxStr["back"] <= 2 && ownedGear["back_special_aetherCloak"] == true) {strength.back = "back_special_aetherCloak";}
					if (maxStr["eyewear"] <= 2 && ownedGear["eyewear_special_aetherMask"] == true) {strength.eyewear = "eyewear_special_aetherMask";}
				} // end if hardMode
				
				// Blessing for Healers INT+CON
				var factor = 1; 
				if (ownedKeys[item].klass == user.stats.class) {var factor = 1.5;} 
				for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
       	 			var gear = gearLocation[i];
					if ((factor * (ownedKeys[item].con + ownedKeys[item].int)) >= maxBles[gear] && ownedKeys[item].type == gear && ownedKeys[item].twoHanded != true) {
						blessing[gear] = ownedKeys[item].key; 
						maxBles[gear] = (factor * (ownedKeys[item].con + ownedKeys[item].int));
					}  // end if
				} // end for var i in gearLocation

		} // end for var Item in ownedGear
	
	
		//second run: checking if there is a two-handed weapon more valueable than single handed weapon + shield
		//content.gear.flat["weapon_wizard_6"].int = 35; // corrupting one entry for testing purpose and set its INT higher as 32 so it will be chosen... delete if works
		var weaponIntPoints = 0; 
		var shieldIntPoints = 0; 
		var weaponPlusShieldIntPoints = 0;
		var twoHandedIntPoints = 0;
		var weaponPerPoints = 0; 
		var shieldPerPoints = 0; 
		var weaponPlusShieldPerPoints = 0; 
		var twoHandedPerPoints = 0;  
		
		//INT          //will it be necessary to calculate PER, STR, etc. also?
		if ('weapon' in intelligence) { 
			weaponIntPoints = ownedKeys[intelligence["weapon"]].int;
			if (ownedKeys[intelligence.weapon].klass == user.stats.class) {weaponIntPoints += 0.5 * weaponIntPoints; } 
			}
		 	if ('shield' in intelligence) {
			shieldIntPoints  = ownedKeys[intelligence["shield"]].int;
			if (ownedKeys[intelligence.shield].klass == user.stats.class) {shieldIntPoints += 0.5 * shieldIntPoints; } 
			} 
			weaponPlusShieldIntPoints = weaponIntPoints + shieldIntPoints; 
		
		for (var item in ownedGear){ // var item: Format: nameOfEquipment
			ownedKeys[item] = content.gear.flat[item]; // Habiticas content information about each key	
			twoHandedIntPoints = ownedKeys[item].int;	
			if (ownedKeys[item].klass == user.stats.class) {twoHandedIntPoints += 0.5 * twoHandedIntPoints; }
					
			// if item is not in inventory, set values int, str, per, con to zero so they are not taken in consideration to equip
			// not sure if this is needed... ownedKeys is already set to zero, but might be set back due to above: ownedKeys[item] = content.gear.flat[item]; so calulate this a second time!
			if (ownedGear[item] == false) {
					ownedKeys[item].int = 0;
					ownedKeys[item].per = 0;
					ownedKeys[item].con = 0; 
					ownedKeys[item].str = 0;  
					} 
			
			if (ownedKeys[item].twoHanded == true && twoHandedIntPoints > weaponPlusShieldIntPoints) {
						intelligence.weapon = item; 
						delete intelligence.shield;  // twoHanded weapon doesn't allow for a shield
			} // end if 
			
			
		//PER          //will it be necessary to calculate PER, STR, etc. also?
		if ('weapon' in perception) { 
			weaponPerPoints = ownedKeys[perception["weapon"]].per;
			if (ownedKeys[perception.weapon].klass == user.stats.class) {weaponPerPoints += 0.5 * weaponPerPoints; } 
			}
		if ('shield' in perception) {
			shieldPerPoints  = ownedKeys[perception["shield"]].per;
			if (ownedKeys[perception.shield].klass == user.stats.class) {shieldPerPoints += 0.5 * shieldPerPoints; } 
			} 
			weaponPlusShieldPerPoints = weaponPerPoints + shieldPerPoints; 
		
		for (var item in ownedGear){ // var item: Format: nameOfEquipment
			ownedKeys[item] = content.gear.flat[item]; // Habiticas content information about each key	
			twoHandedPerPoints = ownedKeys[item].per;	
			if (ownedKeys[item].klass == user.stats.class) {twoHandedPerPoints += 0.5 * twoHandedPerPoints; }
					
			// if item is not in inventory, set values int, str, per, con to zero so they are not taken in consideration to equip
			// not sure if this is needed... ownedKeys is already set to zero, but might be set back due to above: ownedKeys[item] = content.gear.flat[item]; so calulate this a second time!
			if (ownedGear[item] == false) {
					ownedKeys[item].int = 0;
					ownedKeys[item].per = 0;
					ownedKeys[item].con = 0; 
					ownedKeys[item].str = 0;  
					} 
			
			if (ownedKeys[item].twoHanded == true && twoHandedPerPoints > weaponPlusShieldPerPoints) {
						perception.weapon = item; 
						delete perception.shield;  // twoHanded weapon doesn't allow for a shield
			} // end if
		}	// end for var item in ownedGear
		} // end second run: for var item in ownedGear 

		addWardrobesToSkills();
		getEquippedWardrobes();

} // end of getMaxGear
 	
function addWardrobesToSkills() {
	var field = ["field1", "field2", "field3", "field4"];
	field.forEach(function(item, value){
		var s = skills[user.stats.class][item].nameOfWardrobe;
			if (s == 'Intelligence') {skills[user.stats.class][item].wardrobe = intelligence} 
			if (s == 'Perception') {skills[user.stats.class][item].wardrobe = perception} 
			if (s == 'Strength') {skills[user.stats.class][item].wardrobe = strength} 
			if (s == 'Blessing') {skills[user.stats.class][item].wardrobe = blessing} 
			if (s == 'Constitution') {skills[user.stats.class][item].wardrobe = constitution} 
	}); // end field.forEach
}	// end function addWardrobesToSkills
	
function getEquippedWardrobes() {	
		// wardrobeEquipped = []; // not the solution to reject double enties! It causes Initial to fail
 		// get array with all wardrobes currently equipped 
		if (wardrobeEquipped.includes('Initial')) {wardrobeEquipped = ['Initial'];
				} else {
				wardrobeEquipped = [];
				}	
		
        if (compareGear(intelligence) == true && !wardrobeEquipped.includes('intelligence')) {wardrobeEquipped.push('intelligence');};
        if (compareGear(perception) == true && !wardrobeEquipped.includes('perception')) {wardrobeEquipped.push('perception');};
        if (compareGear(strength) == true && !wardrobeEquipped.includes('strength')) {wardrobeEquipped.push('strength');};
        if (compareGear(blessing) == true && !wardrobeEquipped.includes('blessing')) {wardrobeEquipped.push('blessing');};
        if (compareGear(constitution) == true && !wardrobeEquipped.includes('constitution')) {wardrobeEquipped.push('constitution');};
        if (compareGear(legendary) == true && !wardrobeEquipped.includes('legendary')) {wardrobeEquipped.push('legendary');};
        if (wardrobeEquipped.length > 1) {wardrobeEquipped = wardrobeEquipped.filter(function(item){return item !== 'Initial'}); }; // get rid of 'Initial' in case any other wardrobe matches
 		addBorderToSelectedWardrobe();	
		
        function compareGear(specificWardrobe){ //checks if the currently equipped gear is equal to one of the wardrobes
               var equipped = true
               for (var gear in specificWardrobe){
                       if (specificWardrobe[gear] != user.items.gear.equipped[gear]) {
                               equipped = false; 
                       } // end if    
               } // end for gear in specificWardrobe
               return equipped; 
        }; // end of function compareGear
} // end of getEquippedWardrobes 
		
	function calculateAttributes(wardrobe) {
		var equipment = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
		var bonus = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
		var total = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
		var totalUnbuffed = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
		var totalPerfectDay = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
		var level = 0;
		var perfectDay = 0;
		var manaRefresh = 0;
		var impactSkill = 0;
		var stealth = 0; // rogue
		var backstab = 0; 
		var pickpocket = 0; 
		var blessing = 0;
		var protectiveAura = 0; 
		var valorousPresence = 0;
		var earthquake = 0;  // mage
		var burstOfFlames = 0; 
		var etherealSurge = 0;
		var chillingFrost = 0; 
		var wardrobeKeys = {};
    	for (var typeOfItem in wardrobe) { //wardrobe is an altered copy of user.items.gear.equipped and contains optimized gear for INT, STR, CON, PER, BLES
       	 	var key = wardrobe[typeOfItem]; // format key: weapon_base_0 e.g.
			wardrobeKeys[key] = content.gear.flat[key];
			if (typeOfItem in wardrobe === true && typeof wardrobeKeys[key] != 'undefined') {
				if (wardrobeKeys[key].klass == user.stats.class){
					bonus.int += 0.5 * wardrobeKeys[key].int;
					bonus.str += 0.5 * wardrobeKeys[key].str;
					bonus.per += 0.5 * wardrobeKeys[key].per;
					bonus.con += 0.5 * wardrobeKeys[key].con;
					}
				equipment["int"] += wardrobeKeys[key].int;
				equipment["per"] += wardrobeKeys[key].per;
				equipment["str"] += wardrobeKeys[key].str;
				equipment["con"] += wardrobeKeys[key].con;
			} // end if typeof wardrobeKeys ... undefined
		}; // end for
		level = Math.floor(user.stats.lvl / 2);
		perfectDay = Math.round(user.stats.lvl / 2);
		if (perfectDay >= 50) {perfectDay = 50;}
 		if (level > 50) {level = 50;}
		attributes.forEach(function(attr) { //attributes = ["int", "per", "con", "str"]; 
			totalUnbuffed[attr] = level + equipment[attr] + bonus[attr] + user.stats[attr];
			total[attr] = totalUnbuffed[attr] + user.stats.buffs[attr];
			totalPerfectDay[attr] = totalUnbuffed[attr] + perfectDay;		
		});
		manaRefreshPerfectDay 	  = (2 * totalPerfectDay.int + 30) / 10; // manaRefreshPerfectDay is based on 100% completion rate before cron including only Perfect Day buff
		manaRefreshCompletionRate = ((2 * totalUnbuffed.int + 30) / 10) * dailyCompleted / dailyTotal; // manaRefreshCompletionRate includes no buffs and is multipied with completion rate
		var currentMana = user.stats.mp;
		var manaMax = Math.round(2 * total.int + 30); // maximum mana points until cron = ( 2 * buffedINT + 30)
		var habit = 0.0025 * manaMax;
		var dailyToDo = 0.01 * manaMax; 
		if (manaMax < 100) {habit = 0.25; dailyToDo = 1;}
		var manaMaxAfterCronCompletionRate = Math.round(2 * totalUnbuffed.int + 30); // at cron on a non-Perfect Day, all buffs are reset to zero
		var manaMaxAfterCronPerfectDay 	   = Math.round(2 * totalPerfectDay.int + 30)//;  + Math.round(level / 2); // at cron on a Perfect Day all buffs are reset to zero, except Perfect Day buff
		var manaAfterCronCompletionRate	   = Math.round(currentMana + manaRefreshCompletionRate); // before checking if manaMaxAfterCron is exceeded.
		var manaAfterCronPerfectDay		   = Math.round(currentMana + manaRefreshPerfectDay); // before checking if manaMaxAfterCron is exceeded.
		var manaCapCompletionRate = 0;
		var manaCapPerfectDay = 0;
		if (dailyCompleted == dailyTotal) { // fixes bug displaying mana max after cron without perfect day buff on the left column when all dailies are completed 
			manaMaxAfterCronCompletionRate = manaMaxAfterCronPerfectDay;
			manaRefreshCompletionRate = manaRefreshPerfectDay; 
			manaAfterCronCompletionRate = manaAfterCronPerfectDay; 
		}
		if (manaAfterCronCompletionRate >= manaMaxAfterCronCompletionRate) {
			manaCapCompletionRate = manaAfterCronCompletionRate - manaMaxAfterCronCompletionRate;
		}
		if (manaAfterCronPerfectDay >= manaMaxAfterCronPerfectDay) {
			manaCapPerfectDay = manaAfterCronPerfectDay - manaMaxAfterCronPerfectDay;
		}

		//rogue
		function toolsOfTheTrade(unbuffedPer) {return Math.ceil(100 * unbuffedPer / (unbuffedPer + 50));}
		stealth = Math.ceil(0.64 * dailyTotalStealth * total.per / (total.per + 55));
		backstab = (mostValueableTaskValue + 1) +( 0.5 * total.str); 
		pickpocket =(100*(mostValueableTaskValue + 1 + (0.5 * total.per))) / 100;  
		//healer
		blessing = Math.round((total.int + total.con + 5) * 0.04);
		protectiveAura = Math.round((200 * totalUnbuffed.con) / (200 + totalUnbuffed.con));
		healingLight =  Math.ceil((total.con + total.int + 5) * 0.075); 
		searingBrightness = Math.round(4 * (total.int / (total.int + 40))); 
		//warrior
		brutalSmashTask = Math.round((2.5 * total.str / (total.str + 35)));
		brutalSmashDamage = Math.round(55 * total.str / (total.str + 70));
		valorousPresence = Math.ceil((20 * totalUnbuffed.str) / (200 + totalUnbuffed.str));
		defensiveStance = Math.ceil(40 * totalUnbuffed.con / (totalUnbuffed.con + 200));
		intimidatingGaze = Math.ceil(24 * totalUnbuffed.con / (totalUnbuffed.con + 200)); 
		 //mage
		earthquake = Math.ceil((30 * totalUnbuffed.int) / (200 + totalUnbuffed.int));
		burstOfFlames = (mostValueableTaskValue +1) * 0.075 * total.int;
		etherealSurge = Math.ceil((total.int * 25) / (total.int + 125)); 
		htmlStats +='<section class="container">' +
					'<div class="one"><section class="innerContainer"><div class="innerOne"><a style="color: #f74e52; vertical-align: middle">STR:</a><h3>' + total.str + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment["str"] + '<br></a><a>Bonus: ' + bonus.str + '<br></a><a>Allocation: ' + user.stats.str + '<br></a><a>Buffs: ' + user.stats.buffs.str + '</a></div></section></div>' +
					
					'<div class="two"><section class="innerContainer"><div class="innerOne"><a style="color: #2995cd; vertical-align: middle">INT:</a><h3>' + total.int + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment["int"] + '<br></a><a>Bonus: ' + bonus.int + '<br></a><a>Allocation: ' + user.stats.int + '<br></a><a>Buffs: ' + user.stats.buffs.int + '</a></div></section></div>' +
					'</section>';
		htmlStats +='<section class="container">' +
					'<div class="one"><section class="innerContainer"><div class="innerOne"><a style="color: #ffa623; vertical-align: middle">CON:</a><h3>' + total.con + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment["con"] + '<br></a><a>Bonus: ' + bonus.con + '<br></a><a>Allocation: ' + user.stats.con + '<br></a><a>Buffs: ' + user.stats.buffs.con + '</a></div></section></div>' +
					
					'<div class="two"><section class="innerContainer"><div class="innerOne"><a style="color: #4f2a93; vertical-align: middle">PER:</a><h3>' + total.per + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment["per"] + '<br></a><a>Bonus: ' + bonus.per + '<br></a><a>Allocation: ' + user.stats.per + '<br></a><a>Buffs: ' + user.stats.buffs.per + '</a></div></section></div>' +
					'</section>';
		// Progression of Mana: 
		var manaLostOnCapCompletionRate = (currentMana + manaRefreshCompletionRate - manaMaxAfterCronCompletionRate);
						if (manaLostOnCapCompletionRate < 0) {
							manaLostOnCapCompletionRate = 0;
						} else { // Perfect Day
							manaAfterCronCompletionRate = manaMaxAfterCronCompletionRate;
						}
		var manaLostOnCapPerfectDay = (currentMana + manaRefreshPerfectDay - manaMaxAfterCronPerfectDay);
						if (manaLostOnCapPerfectDay < 0) {
							manaLostOnCapPerfectDay = 0;
							manaAfterCronPerfectDay = currentMana + manaRefreshPerfectDay;
						} else {
							manaAfterCronPerfectDay = manaMaxAfterCronPerfectDay;
						}
		// Progression of Mana around Cron time
		htmlStats +='<section class="containerMana"><div style="font-weight: bold">&nbsp; Progression of Mana</div>'+
					'<div class="left">Dailies completed:<br><br>' + //first column
					'current Mana:<br>' +
					'Mana refresh at cron:<br>'+
					'Mana lost on cap:<br>'+
					'Mana after Cron:<br>'+
					'Mana max after Cron:'+
					'</div>'+
					'<div class="middle">'+ // second column 
					 + dailyCompleted + '/' + dailyTotal +'<br>'+ // not all Dailies completed
					'<br>'+
					Math.round(currentMana) +'<br>'+ //current mana
					Math.round(manaRefreshCompletionRate) +'<br>'+ // mana refresh calculated on ratio of completed dailies
					Math.round(-manaLostOnCapCompletionRate) +'<br>'+
					Math.round(manaAfterCronCompletionRate) +'<br>'+
					manaMaxAfterCronCompletionRate +
					'</div>'+
					'<div class="right">'+ // third column
					 + dailyTotal + '/' + dailyTotal +'<br>'+ // all Dailies completed
					'<br>'+
					 Math.round(currentMana) +'<br>'+ // current mana
					 Math.round(manaRefreshPerfectDay) +'<br>'+
					 Math.round(-manaLostOnCapPerfectDay) +'<br>'+
					 Math.round(manaAfterCronPerfectDay) +'<br>' +
					 manaMaxAfterCronPerfectDay +
					'</div></section>';
		// Skills
		htmlStats +='<section class="container" style="margin: 5px">'+
					'<div class="skills" style="background-color: #ffffff"> Impact of Skills<br>';
					// ROGUE
					if (user.stats.class == 'rogue') {
						var x = totalUnbuffed.per;
						var y = toolsOfTheTrade(x); // y = toolsOfTheTrade variable
						var z = y;  // z = toolsOfTheTrade fix
						var high = 0; 
						var low = 0;
						// Schleife nach unten  
						while (y == z) {
							x--;
							y  = toolsOfTheTrade(x);
							}
							low = x + 1; 
						// Schleife nach oben  
						x = totalUnbuffed.per;
						y = toolsOfTheTrade(x);
						z = y;  
						while (y == z) {
							x++;
							y  = toolsOfTheTrade(x);
							}
							high = x - 1; 
							
						// start display Skills-section
						htmlStats += '<a class="wrap">'; 
						htmlStats += '<font size="-2">Tools of the Trade: +' + z +'PER<br>';	
						//htmlStats += 'PER<sub>unb</sub>=' + totalUnbuffed.per + '&#8712;{' + low + ',..,' + high + '}<br>';
						htmlStats += 'Stealth: ' + stealth + ' dailies<br>';  
						var xp = Math.round(10 * 75*backstab / (backstab + 50)) / 10; 
						var goldBackstab = Math.round(100*18 * backstab / (backstab + 75)) / 100;
						htmlStats += 'Backstab: ' + xp + 'XP+' + goldBackstab + 'GP<br>' ;
						var goldPickpocket = Math.round(100 * 25 * pickpocket / (pickpocket + 75)) / 100;
						htmlStats +='Pickpocket: ' + goldPickpocket + 'GP</font>';
						// Tooltips
						htmlStats += '<p class="descriptionSkills">Tools of the Trade: +' + z + ' PER.<br><font size ="-2">Based on unbuffed Per: (' + totalUnbuffed.per + ')<br>';
						htmlStats += 'Unbuffed Per in range of ' + low + ' ... ' + high + ' will have same effect.</font><br><br>'; 
						htmlStats += 'Stealth: <font size="-2"> you will avoid </font>' + stealth + '<font size ="-2"> dailies<br>based on Per: (' + total.per + ')</font><br><br>';
						htmlStats += 'Backstab: +' + xp + ' XP +' + goldBackstab + ' GP<br><font size ="-2">Base on STR: (' + total.str + ')<br>';
						htmlStats += 'and your task: ' + mostValueableTaskName + ' with a value of ' + (Math.round(mostValueableTaskValue)) + '</font><br><br>';
						htmlStats += 'Pickpocket: ' + goldPickpocket + '<font size = "-2"><br>Based on Per: (' + total.per + ') and your task: ' + mostValueableTaskName + ' with a value of ' + (Math.round(mostValueableTaskValue)) + '</font>';
						htmlStats += '</p></a>';
						} // end if ROGUE & continue Flexbox 2, 4, 6
					//MAGE
					if (user.stats.class == 'wizard') {
						var x = totalUnbuffed.int;
						var y = earthquake; 
						var high = 0; 
						var low = 0;
						// Schleife nach unten  
						while (y == earthquake) {
							x--;
							y  = Math.round((30 * x) / (200 + x));
							}
							low = x + 1; 
						// Schleife nach oben  
						var x = totalUnbuffed.int;
						var y = earthquake; 
						while (y == earthquake) {
							x++;
							y  = Math.round((30 * x) / (200 + x));
							}
							high = x - 1; 
						htmlStats += '<a class="wrap">'; 	
						htmlStats += '<font size="-2">Earthquake: +' + earthquake + 'INT<br>';	
						//htmlStats += 'INT<sub>unb</sub> = ' + totalUnbuffed.int  + '&#8712;{' + low + ',..,' + high + '}<br>';
						htmlStats += 'Eth.Surge : +' + etherealSurge + 'MP<br>';  
						var xp = Math.round(75 * burstOfFlames / (burstOfFlames + 37.5));
						htmlStats += 'BrstfFlms: ' + total.int / 10 + 'dmg, ' + xp + 'XP<br></font>';
						// Tooltips 
						htmlStats += '<p class="descriptionSkills">Earthquake: +' + earthquake + ' INT.<br><font size ="-2">Based on unbuffed Int: (' + totalUnbuffed.int + ')<br>';
						htmlStats += 'Unbuffed Int in range of ' + low + ' ... ' + high + ' will have same effect.</font><br><br>'; 
						htmlStats += 'Ethereal Surge: +' + etherealSurge + 'MP <font size ="-2">for non Mages<br>based on Int: (' + total.int + ')</font><br><br>';
						htmlStats += 'Burst of Flames: +' + (Math.ceil(total.int / 10)) + 'DMG +' + xp + 'XP<br><font size ="-2">Base on Int: (' + total.int + ')<br></font>';
						htmlStats += '</p></a>';
						}
					
					// HEALER	
					if (user.stats.class == 'healer') {
						htmlStats += '<font sitze ="-2">Healing Light: +' + healingLight + 'HP <br>';
						htmlStats += 'Sear.Brightness: ' + searingBrightness + '<br>'; 
						htmlStats += 'Protective Aura: +' + protectiveAura + 'CON<br>';
						htmlStats += 'Blessing: +' + blessing + 'HP</font>';
						}
					//WARRIOR
					if (user.stats.class == 'warrior') {
						htmlStats += '<font size="-2">BrtSmsh: ' + brutalSmashTask + 'TskVal, +' + brutalSmashDamage + 'dmg<br>'; 
						htmlStats += 'DefStance: +' + defensiveStance + 'CON<sub>You</sub><br>'; 
						var x = totalUnbuffed.str;
						var y = valorousPresence; 
						var high = 0; 
						var low = 0;
						// Schleife nach unten  
						while (y == valorousPresence) {
							x--;
							y  = Math.round((20 * x) / (200 + x));
							}
							low = x + 1; 
						// Schleife nach oben  
						var x = totalUnbuffed.str;
						var y = valorousPresence; 
						while (y == valorousPresence) {
							x++;
							y  = Math.round((20 * x) / (200 + x));
							}
							high = x - 1; 
						htmlStats += 'Val.Pres.: +' + valorousPresence + 'STR<sub>Party</sub><br>';	
						htmlStats += 'STR<sub>unb</sub> = ' + totalUnbuffed.str  + '&#8712;{' + low + ',..,' + high + '}<br>';
						htmlStats +='Int.Gaze: +' + intimidatingGaze + 'CON<sub>Party</sub></font>';
						} // end if WARRIOR
		htmlStats +='</div>'+
					'<div class="mana" style="background-color: #ffffff"> Maximum Mana: ' + manaMax + '<br>' +
					'Mana refresh ...<br>' +
					'- per Habit: ' + (Math.round((habit * 100)) / 100) + '<br>' +
					'- per Daily: ' + (Math.round((dailyToDo * 100)) / 100) + '<br>' +
					'- per To-Do: ' + (Math.round((dailyToDo * 100)) / 100) + '<br>' +
					'</div></section>';
					 	
}; // end of function calculateAttributes




//////////////////////////////
//// calculate and display Skills, Wardrobes and stats
//////////////////////////////	

///////////push in skills container 
evaluateTasks(); 

htmlStats =		'<div class="skills-Container">'; //needs class for toggling between Wardrobes and Skills FrontEnds

htmlStats +=		'<div id="skill1"><br>'+ 
				'<button type="button" id="castSkill1" style="color: #2995cd"> Cast ' + skills[user.stats.class].field1.name + '</button>'+
				'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field1.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field1.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub1" class="sub">-</button>'+
    			'<input type="number" id="amount1" value="1" class="number">'+
    			'<button type="button" id="add1" class="add">+</button><br>'+
				'<br>'+
				'</div>'+

				'<div id="skill2"><br>'+
				'<button type="button" id="castSkill2" style="color: #2995cd"> Cast ' + skills[user.stats.class].field2.name + '</button>';
				if (user.stats.class == 'wizard') {htmlStats += '<br>on ' + skills.wizard.field2.task};
				if (user.stats.class == 'warrior') {	htmlStats += '<br>on ' + skills.warrior.field2.task};
htmlStats +=		'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field2.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field2.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub2" class="sub">-</button>'+
    			'<input type="number" id="amount2" value="1" class="number">'+
				'<button type="button" id="add2" class="add">+</button>'+
				'<br>'+ 
				'</div>'+
				
				'<div id="skill3"><br>'+
				'<button type="button" id="castSkill3" style="color: #2995cd"> Cast ' + skills[user.stats.class].field3.name + '</button>';
				if (user.stats.class == 'rogue') {htmlStats += '<br>on ' + skills.rogue.field3.task};
htmlStats += 	'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field3.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field3.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub3" class="sub">-</button>'+
    			'<input type="number" id="amount3" value="1" class="number">'+
    			'<button type="button" id="add3" class="add">+</button>'+
				'<br>'+
				'</div>'+
				
				'<div id="skill4"><br>'+
				'<button type="button" id="castSkill4" style="color: #2995cd"> Cast ' + skills[user.stats.class].field4.name + '</button>';
				if (user.stats.class == 'rogue') {htmlStats += '<br>on ' + skills.rogue.field4.task};
htmlStats += 	'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field4.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field4.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub4" class="sub">-</button>'+
    			'<input type="number" id="amount4" value="1" class="number" />'+
    			'<button type="button" id="add4" class="add">+</button>'+
				'<br>'+
				'</div>';
	
	htmlStats += '<div>Return to Wardrobe Intelligence: '+
				'<input type="checkbox" id="rememberGear"></input>'+
				'</div>';  			
				
	
	
	htmlStats += '</div>'; //end div skills-Container 
	
	
//////////end push in skills container




	
//	drawFlexboxes;

//function drawFlexboxes() {		

	function picsToFlexbox(copyGear) {
		htmlStats +='<br>'; 	
		for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
       	 	var gear = gearLocation[i];
			if (gear in copyGear === true && typeof copyGear[gear] != 'undefined' ) {
					htmlStats += '<a class="wrap"><img src="https://habitica-assets.s3.amazonaws.com/mobileApp/images/shop_' + copyGear[gear] + '.png">' + 
  					'<p class="description">' + content.gear.flat[copyGear[gear]].text +
					'<br>INT: ' + content.gear.flat[copyGear[gear]].int + ' PER: ' + content.gear.flat[copyGear[gear]].per +
					'<br>STR: ' + content.gear.flat[copyGear[gear]].str + ' CON: ' + content.gear.flat[copyGear[gear]].con + '</p>' ;
					} // end if copyGear[gear]
			} // end for var i in gearLocation
		htmlStats +='</a></div>'; // end single box (flexbox 2 - intelligence)
	} // end function picsToFlexboxes


	$('H1').hide();
	$('#headerExtras').html(
		'<div class="navbar">' +
			'<b>Habitican Wardrobes' +
			//'<br><span class="small">v. 2.0 (July 2019)</span>' +
			'</b>' +
			'<a id="toggleFrontEnd"><i class="fa fa-copy" aria-hidden="true"></i>&nbsp; Wardrobes/Skills</a>' +
  			'<div class="dropdown">' +
				'<button class="dropbtn"><i class="fa fa-book fa-fw" aria-hidden="true"></i>&nbsp; Data ' +
      			'<i class="fa fa-caret-down"></i>' +
    			'</button>' +
    			'<div class="dropdown-content">' +
      				'<a id="b">User Data</a>' +
      				'<a id="a">Habitica Content</a>' +
      				'<a id="c">Skills</a>' +
	  				'<a id="DGR">Gear</a>' +
	  				'<a id="TAS">Tasks</a>' +
	  				'<a id="HLP">Help</a>' +
	  				'<a id="VER">Version Info</a>' +
    			'</div>' +
  			'</div> ' +
			'<a id="SET"><i class="fa fa-cog fa-fw" aria-hidden="true"></i>&nbsp; Settings</a>' +
  			'<div class="topnav-right">' +  
  				'<a id="RFR"><i class="fa fa-refresh" aria-hidden="true"></i>&nbsp; Refresh</a>' +
				'<b>' + user.profile.name + '<br><span class="small">' + user.stats.class + '</span></b>' +
			'</div>' +
		'</div>'
	);

	
	if (hardMode == "true") {
			document.getElementById("hardMode").checked = true;
			}
	else {
			document.getElementById("hardMode").checked = false;
			} 
	
	evaluateTasks();
	checkLegendaryGear();
	getMaxGear(); 


	htmlStats += '<div class="wardrobes-Container">'; 
	var copyGear = JSON.parse(JSON.stringify(user.items.gear.equipped)); // make a deep copy of user.items.gear.equipped so not to corrupt the origninal var
	legendary.headAccessory = copyGear.headAccessory; // Accessory in legendary is deriven from effective equipment
	legendary.back = copyGear.back;
	legendary.body = copyGear.body;
	legendary.eyewear = copyGear.eyewear;
	//start flexbox 1
	// initialGear: 
	htmlStats += '<div id="Initial" style="background-color: #cccccc"><h3>Equipped Gear:</h3>'; 
	
	calculateAttributes(copyGear); // continue with content of flexbox 1 there
	htmlStats +='<br>'; 	
		for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
       	 	var gear = gearLocation[i];
			if (gear in copyGear === true) {	
					htmlStats += '<a class="wrap"><img src="https://habitica-assets.s3.amazonaws.com/mobileApp/images/shop_' + copyGear[gear] + '.png">' + 
  					'<p class="description">' + content.gear.flat[copyGear[gear]].text +
					'<br>INT: ' + content.gear.flat[copyGear[gear]].int + ' PER: ' + content.gear.flat[copyGear[gear]].per +
					'<br>STR: ' + content.gear.flat[copyGear[gear]].str + ' CON: ' + content.gear.flat[copyGear[gear]].con + '</p>' ;
					} // end if copyGear[gear]
			} // end for var i in gearLocation
	htmlStats +='</a></div>'; // end single box (flexbox 2, 3, ...6)


	// start Flexbox 2
	// INTELLIGENCE
	htmlStats +='<div id="Intelligence" style="background-color: #2995cd"><h3>Wardrobe Intelligence:  <input id="INT" type="submit" value=" Equip "></h3>'; //e0ffff
	// copy intelligence to copyGear so not to pullute user.items.gear.equipped anymore. 
	copyGear = {};
	gearLocation.forEach(function(gear) {
		if (gear in intelligence) {
				copyGear[gear] = intelligence[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
	
	// start flexbox 3
	// PERCEPTION
	htmlStats +='<div id="Perception" style="background-color: #4f2a93"; border: solid><h3>Wardrobe Perception:  <input id="PER" type="submit" value=" Equip "></h3>'; //continue Flexbox 5 ffdfff
	copyGear = {};
	gearLocation.forEach(function(gear) {
		if (gear in perception) {
				copyGear[gear] = perception[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
		
	// start Flexbox 4
	// STRENGTH
	htmlStats +='<div id="Strength" style="background-color: #f74e52"><h3>Wardrobe Strength:  <input id="STR" type="submit" value=" Equip "></h3>'; //continue Flexbox 7 ff9999
	copyGear = {};
	gearLocation.forEach(function(gear) {
		if (gear in strength) {
				copyGear[gear] = strength[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
	
	// start Flexbox 5 
	// CONSTITUTION
	htmlStats +='<div id="Constitution" style="background-color: #ffa623"><h3>Wardrobe Constitution:  <input id="CON" type="submit" value=" Equip "></h3>'; //continue Flexbox 9 f9f9c9
	copyGear = {};
	gearLocation.forEach(function(gear) {
		if (gear in constitution) {
				copyGear[gear] = constitution[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 	
	
	// Start Flexbox 6
	// BLESSING
	htmlStats +='<div id="Blessing" style="background-color: #f9f9c9"><h3>Wardrobe Blessing:  <input id="BLE" type="submit" value=" Equip "></h3>'; //continue Flexbox 9
	copyGear = {};
	gearLocation.forEach(function(gear) {
		if (gear in blessing) {
				copyGear[gear] = blessing[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
	// Start Flexbox 7
	// LEGENDARY
	htmlStats +='<div id="Legendary" style="background-color: #aabb88"><h3>Wardrobe Legendary: ';
	if (legendaryGearOwned == true) {htmlStats +='<input id="LEG" type="submit" value=" Equip ">'}
	htmlStats += '</h3>'; //continue Flexbox 9
	copyGear = {};
	gearLocation.forEach(function(gear) {
		if (gear in legendary) {
				copyGear[gear] = legendary[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	

	// Flexbox for info about which wardrobe is currently equipped and for some buttons
	htmlStats +='<div id="Overview and Buttons">You are wearing:' +
				'<div id="percept">Wardrobe PER</div>' +
				'<div id="blessin">Wardrobe Blessing</div>' +
				'<div id="strengt">Wardrobe STR</div>' +
				'<div id="initial">Initial wardrobe</div>' +
				'<div id="intelli">Wardrobe INT</div>' +
				'<div id="constit">Wardrobe CON</div>' +
				'<div id="legenda">Legendary wardrobe</div>' +
				'<div>You have ' + dailyCompleted + ' of ' + dailyTotal + ' dailies completed.<div></div></div>' +
				'<div>Your most valueable taks is: </div><div> ' + mostValueableTaskName + '<div></div><div> with a value of: ' + Math.round(mostValueableTaskValue) + '</div><div></div>' +
				'</div>' + // end single box;
				'</div>'; // end Flexboxes

			

	$('#userStats').html(htmlStats);
	addBorderToSelectedWardrobe();
	
	getFirstLocalStorage();
	


//	} // end function drawFlexboxes; 



function addBorderToSelectedWardrobe() {
	
	//this is triggerd 2x. 1- immediately, 2- after all Ajax-calls are done. 
	// display of data in last Flexbox
	$("#percept").hide();
	$("#constit").hide();
	$("#strengt").hide();
	$("#blessin").hide();
	$("#intelli").hide();
	$("#legenda").hide();
	$("#initial").hide();
	
	//border to displayed wardrobes
	$("#Intelligence").css({"border": "none", "border-color": "yellow"});
	$("#Perception").css({"border": "none", "border-color": "yellow"});
	$("#Constitution").css({"border": "none", "border-color": "yellow"});
	$("#Strength").css({"border": "none", "border-color": "yellow"});
	$("#Blessing").css({"border": "none", "border-color": "yellow"});
	$("#Legendary").css({"border": "none", "border-color": "yellow"});

	if (wardrobeEquipped == 'Initial') { // show if initial wardrobe is not one of Habitican Wardrobes, else hide Initial
		$('#Initial').css({"border": "solid", "border-color": "#4f2a93"});
		} else
		{$('#Initial').hide();}
	if (wardrobeEquipped.includes('intelligence')) {$('#intelli').show(); $("#Intelligence").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('perception')) {$('#percept').show(); $("#Perception").css({"border": "solid", "border-color": "#af8af3"});}
	if (wardrobeEquipped.includes('constitution')) {$('#constit').show();$("#Constitution").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('strength')) {$('#strengt').show();$("#Strength").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('blessing')) {$('#blessin').show();$("#Blessing").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('legendary')) {$('#legenda').show();$("#Legendary").css({"border": "solid", "border-color": "#4f2a93"});}
}; // end of function addBorderToSelectedWardrobe




function prepareSkillAmounts () {
	var skillAmount = [];
	for (var i = 1; i <= 4; i++) {
		var fetchField = "skill" + JSON.stringify(i); 
		var fetchAmount = "amount" + JSON.stringify(i);
		var inputFieldLS = storeData(fetchField);
		

		if (storeData(fetchField) == null || (storeData(fetchField) == "undefined")) {
				skillAmount[i-1] = "1"; 
				}
		if ((storeData(fetchField) != null) && (storeData(fetchField) != "undefined")) { 
				skillAmount[i-1] = storeData(fetchField);  
			}
			storeData(fetchField, skillAmount[i-1]); 
			document.getElementById(fetchAmount).value = skillAmount[i-1];
	}	// end for
} // end function prepareSkillAmounts


// limit the amount of skills to the current Mana-level
function getAmountOfSkill(field) {

		if (field == 'field1') {
			amountOfSkill = document.querySelector("#amount1").value;
			if (amountOfSkill > 0) {storeData("skill1", parseInt(document.querySelector("#amount1").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor(user.stats.mp / skills[user.stats.class].field1.cost) <= amountOfSkill) {
					amountOfSkill = Math.floor((user.stats.mp) / (skills[user.stats.class].field1.cost));
					if (amountOfSkill = "NaN") {
						amountOfSkill = 0;  
						}
			//document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		
		if (field == 'field2') {
			amountOfSkill = document.querySelector('#amount2').value;
			if (amountOfSkill > 0) {storeData('skill2', parseInt(document.querySelector("#amount2").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor((user.stats.mp / skills[user.stats.class].field2.cost))	 < amountOfSkill) {
					amountOfSkill = Math.floor(user.stats.mp / skills[user.stats.class].field2.cost);
					if (amountOfSkill = "NaN") {
						amountOfSkill = 0;  
					}
			console.log(amountOfSkill);
			// document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		if (field == 'field3') {
			amountOfSkill = document.querySelector("#amount3").value;
			if (amountOfSkill > 0) {storeData("skill3", parseInt(document.querySelector("#amount3").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor((user.stats.mp / skills[user.stats.class].field3.cost))	 < amountOfSkill) {
					amountOfSkill = Math.floor(user.stats.mp / skills[user.stats.class].field3.cost);
					if (amountOfSkill = "NaN") {
					amountOfSkill = 0;  
					}
			console.log(amountOfSkill);
			// document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		
		
		if (field == 'field4') {
			amountOfSkill = document.querySelector("#amount4").value;
			if (amountOfSkill > 0) {storeData("skill4", parseInt(document.querySelector("#amount4").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor((user.stats.mp / skills[user.stats.class].field4.cost))	 < amountOfSkill) {
					amountOfSkill = Math.floor(user.stats.mp / skills[user.stats.class].field4.cost);
					if (amountOfSkill = "NaN") {
					amountOfSkill = 0;  
					}
			console.log(amountOfSkill);
			// document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		return amountOfSkill;
	} // end of getAmountOfSkill





//////////////////////////////////////////////////////////////////////
////   equip function      (within paseData)   ///////////////////////
////   and castSkill function				   ///////////////////////			
//////////////////////////////////////////////////////////////////////

		
// https://petetasker.com/using-async-await-jquerys-ajax/

async function doAjax(url){
		let result;  
		try {
			result = await $.ajax({	
					url: url,
					type: 'POST',
					dataType: 'json',
					cache: false,
					beforeSend: function(xhr){
						//xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
						xhr.setRequestHeader('x-api-user', userID);
						xhr.setRequestHeader('x-api-key',  apiToken);
					},
					success: function(result){}
			});
		return result;
		} catch (error) {
			console.log(error.responseText);
		}						
}; // end ajax


function wait(waitTime) {
  return new Promise(resolve => setTimeout(() => {
    resolve()
  }, waitTime));
}

async function callSkill(amount, url, name, cost, nameOfWardrobe, field) {  
  if (user.stats.class == 'wizard' && field == 'field2') {url += '?targetId=' + skills.wizard[field].taskId;}
  if (user.stats.class == 'warrior'&& field == 'field2') {url += '?targetId=' + skills.warrior[field].taskId;}
  if (user.stats.class == 'rogue' && (field == 'field3' || field == 'field4')) {url += '?targetId=' + skills.rogue[field].taskId;}  
  for (var i = 1; i <= amount; i++) {
		$('#modalContent').html('casting: ' + name + '<br>' + i + '/' + amount);		
		if (url.includes('?')) {
			$('#modalContent').html('casting: ' + name + '<br> on ' + skills[user.stats.class][field].task + '<br>' + i + '/' + amount);		
			}		
		await doAjax(url);
		user.stats.mp = (user.stats.mp - cost);
  		await wait(1000+(1000 * amount / (0.01 * amount + 20)));
  		}				
  console.log("skills complete!");
  parseData();
} // end callSkills...



async function callWardrobe(wardrobe, nameOfWardrobe) {  // wardrobe is intelligence, perception or legendary, each with head, armor, shield and weapon
		$('#modalContent').html('Equipping...');
		$('#modal').show();
		//console.log('caller: ' + .caller);
		equipCount = 0;
		equipCountSkip = 0; 
		for (var i in gearLocation) { //gearLocation = [head, armor, ... eyewear], i = 1..8
			itemToEquip = wardrobe[gearLocation[i]];  // fromat gear: head_base_0 e.g.
			// First determine the type [Helm, Armor ...] of the Item that is goint to be equipped (The type is taken from Habitica's content)
			typeOfItem = content.gear.flat[itemToEquip].type; //eg displays: head (good)
			// verify if item is already equipped
			htmlEnd += content.gear.flat[itemToEquip].text + '<br>';
					
			if (user.items.gear.equipped[typeOfItem] == itemToEquip) {
					equipCountSkip++;
					if (equipCountSkip===Object.keys(wardrobe).length){ // if equipCountSkip = amount of inventory in wardrobe
						$('#modalContent').html('already equipped');
						await wait(1000);
					} // end if equipCountSkip
			} else {	
				url = 'https://habitica.com/api/v3/user/equip/equipped/'+ itemToEquip;
				$('#modalContent').html('Equipping wardrobe ' + nameOfWardrobe + '<br>' + (equipCountSkip + equipCount) + '/8');
				await doAjax(url);	 
				user.items.gear.equipped[typeOfItem] = itemToEquip;
				equipCount++; 
				await wait(50); 		
			} // end else
		}; // end each
		await wait(500);
		$('#modal').hide();
		getEquippedWardrobes();
} // end function callWardrobe
  
  
async function waitForAlert() {
	alert("waiting... please check if everything is as expected!");
}  
 
async function callTriple (amount, url, name, cost, wardrobe, nameOfWardrobe, field){ // amountOfSkill, API, "eg. Tools of the Trade, 25, perception, Object
	if (wardrobeEquipped.includes(nameOfWardrobe)) {
				console.log(nameOfWardrobe + 'already equipped');
				} else {
					console.log("calling wardrobe " + nameOfWardrobe);
					await callWardrobe(wardrobe, nameOfWardrobe); 	// wardrobe ist Object here
					
				}
			$('#modalContent').html('Casting...');
			$('#modal').show();	
			await callSkill(amountOfSkill,
				    skills[user.stats.class][field].API, 
				    skills[user.stats.class][field].name,
				    skills[user.stats.class][field].cost,
					skills[user.stats.class][field].nameOfWardrobe, 
					field);
			getEquippedWardrobes();
			console.log(wardrobeEquipped, rememberGear);
			if (wardrobeEquipped.includes('intelligence')) {
					console.log(nameOfWardrobe + 'already equipped');
			} else {
					if (rememberGear=="true") { // remberGear displays as "Return to wardrobe Intelligence" on the front End. Think in FrontEnd locig here!
							await callWardrobe(intelligence, 'Intelligence');
					} else { 
							console.log("OK. leaving " + name + " equipped.");
							$('#modal').hide();}
			}	
			getEquippedWardrobes();
} // end callTriple
					
async function prepareTriple(amount, url, name, cost, wardrobe, nameOfWardrobe, field){
	if (user.stats.mp < cost) {		// not enoght mana  ==> break up immediately
			$('#modalContent').html('Not enough Mana.');
			$('#modal').show()
			await wait(1000);
			$('#modal').hide();	
	} else {
			if (user.stats.lvl < skills[user.stats.class][field]){ // level not high enough
					$('#modalContent').html('You need to reach level ' + skills[user.stats.class][field].unlock + ' to cast ' + name);
					$('#modal').show();
					await wait(1000);
					$('#modal').hide();
		 	} else {
					callTriple(amount, url, name, cost, wardrobe, nameOfWardrobe, field);
				   } 
				
	} 
} // end function prepareTriple



/////////////////////////////////////////////////
/////////////////////////////////////////////////
///////////////// Buttons ///////////////////////
/////////////////////////////////////////////////

	 
	 $('#buttons').html(buttons);
	 
	 $(document).click(function(event) {
	 	//if you click on anything except the modal itself or the "open modal" link, close the modal
 			if ($(event.target).closest("#modalDataContent, #TAS, #a, #b, #c, #DGR").length == 0) {
					$('#modalData').hide();
			}
			if ($(event.target).closest("#modalSettingsContent, #SET").length == 0) {
					$('#modalSettings').hide();
			}
			if ($(event.target).closest("#modalVersionContent, #VER").length == 0) {
					$('#modalVersion').hide();
			}
				
			if ($(event.target).closest(".close").length == 1) {
				$('#modal').hide();
				$('#modalData').hide();
				$('#modalSettings').hide();
				$('#modalVersion').hide();
				}	
	 });
 	 $('#a').click(function(){
	 			$('#modalDataContent').html(
				'<span class="close">&times;</span>' +
				'<div>This is Habitica\'s content: <br><pre>' + 
				JSON.stringify(content, null, 4) +  
				'</pre></div>');
				$('#modalData').show(); 
				});
	 $('#b').click(function(){
	 			$('#modalDataContent').html(
				'<span class="close" class ="fixedTop">&times;</span>' +
				'<div>This is your user profile: <br><pre>' + 
				JSON.stringify(user, null, 4) +  
				'</pre></div>');
				$('#modalData').show(); 
				});
	 $('#c').click(function(){	 
		 		$('#modalDataContent').html(
				'<span class="close">&times;</span>' +
				'<div>These are your skills: <br><pre>' + 
				JSON.stringify(skills[user.stats.class], null, 4) +  
				'</pre></div>');
				$('#modalData').show(); 
				});  	 
	 $('#TAS').click(function(){
	 			$('#modalDataContent').html(
				'<span class="close">&times;</span>' +
				'<div>These are your tasks: <br><pre>' + 
				JSON.stringify(tasksFromDb, null, 4) +  
				'</pre></div>');
				$('#modalData').show(); 
				});
	 $('#SET').click(function(){
	 			$('#modalSettings').show();
				});		
	 $('#VER').click(function(){
	 			$('#modalVersion').show();
				});					
	 $('#INT').click(function(){
	 			htmlEnd = '<div>Wardrobe INT <br>';
				callWardrobe(intelligence, "Intelligence");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	 $('#PER').click(function(){
	 			htmlEnd = '<div> Wardrobe PER <br>';
				callWardrobe(perception, "Perception");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	  $('#CON').click(function(){
	 			htmlEnd = '<div> Wardrobe CON <br>';
				callWardrobe(constitution, "Constitution");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	 $('#LEG').click(function(){
	 			htmlEnd = '<div>Wardrobe Legendary Equipment <br>';
				callWardrobe(legendary, "Legendary");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	 $('#BLE').click(function(){
	 			htmlEnd = '<div>Wardrobe Blessing (CON + INT) <br>';
				callWardrobe(blessing, 'Blessing');
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});		
	 $('#STR').click(function(){
	 			htmlEnd = '<div>Wardrobe Strength <br>';
				callWardrobe(strength, 'Strength');
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});	
	$('#HLP').click(function(){
				htmlEnd =   '<div>Version 2.0 (Jul. 2019) <br><br>' +
							'For help see <a href="http://habitica.wikia.com/wiki/Habitican_Wardrobes">Habitican Wardrobes</a>' +
							'<br>';
				$('#displayContent').html(htmlEnd);
				$('#modalContent').html('Help pressed');
				$("#modal").show();
				setInterval(function(){
					$("#modal").hide();
					},3000);
				}); // end of click
	$('#DGR').click(function(){
			getMaxGear();
			var displayGear='<span class="close">&times;</span>' +
							'<div><pre>Best INT Gear: ' + JSON.stringify(intelligence, null, 4) + '</pre></div>' +
							'<div><pre>Best PER Gear: ' + JSON.stringify(perception, null, 4) + '</pre></div>' +
							'<div><pre>Best STR Gear: ' + JSON.stringify(strength, null, 4) + '</pre></div>' +
							'<div><pre>Best CON Gear: ' + JSON.stringify(constitution, null, 4) + '</pre></div>' +
							'<div><pre>Best Blessing Gear: ' + JSON.stringify(blessing, null, 4) + '</pre></div>' +
							'<div><pre>Initial Gear HB: ' + JSON.stringify(user.items.gear.equipped, null, 4) + '</pre></div>' +
							'<div><pre>Initial Gear JS: ' + JSON.stringify(initialGear, null, 4) + '</pre></div>';
							'<div><pre>Legendary Gear: ' + JSON.stringify(legendary, null, 4) + '</pre></div>';
							
			$('#modalDataContent').html(displayGear);
			$('#modalData').show();
			}); // end of click
	$('#RFR').click(function(){
			fetchData();
			}); // end of click
	$('#hardMode').click(function(){
		hardMode = JSON.stringify($('#hardMode').is(":checked")); 
		storeData("Hard Mode", hardMode);
			parseData(); 
			}); // end of click
	$('#toggleFrontEnd').click(function(){	
		frontEnd = storeData("FrontEnd"); 
		if (frontEnd == null) {frontEnd = "wardrobes"; }
		if (frontEnd == "wardrobes") {
			$('.wardrobes-Container').hide();
			$('.skills-Container').show(); 
			storeData("FrontEnd", "skills"); 
  			}
		if (frontEnd == "skills") {										
			$('.skills-Container').hide(); 
			$('.wardrobes-Container').show();
			storeData("FrontEnd", "wardrobes");
  			}
		frontEnd = storeData("FrontEnd"); 
		})
	// buttons in the skill-FrontEnd
	$('.add').click(function () {
		if ($(this).prev().val() < 20) {
    		$(this).prev().val(+$(this).prev().val() + 1);
		}
		
		
		})
	$('.sub').click(function () {
		if ($(this).next().val() > 1) {
    		if ($(this).next().val() > 1) $(this).next().val(+$(this).next().val() - 1);
		}
		})
	$('#castSkill1').click(function () {
		storeData('skill1', JSON.stringify(document.querySelector('#amount1').value));
		amountOfSkill = getAmountOfSkill("field1"); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field1.API, 
				  skills[user.stats.class].field1.name,
				  skills[user.stats.class].field1.cost,
				  skills[user.stats.class].field1.wardrobe,
				  skills[user.stats.class].field1.nameOfWardrobe, 
				  'field1');	
		})		
	$('#castSkill2').click(function () {
		storeData('skill2', JSON.stringify(document.querySelector('#amount2').value));
		amountOfSkill = getAmountOfSkill('field2'); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field2.API, 
				  skills[user.stats.class].field2.name,
				  skills[user.stats.class].field2.cost,
				  skills[user.stats.class].field2.wardrobe,
				  skills[user.stats.class].field2.nameOfWardrobe, 
				  'field2');	
		})
	$('#castSkill3').click(function () {
		storeData('skill3', JSON.stringify(document.querySelector('#amount3').value));
		amountOfSkill = getAmountOfSkill('field3'); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field3.API, 
				  skills[user.stats.class].field3.name,
				  skills[user.stats.class].field3.cost,
				  skills[user.stats.class].field3.wardrobe,
				  skills[user.stats.class].field3.nameOfWardrobe, 
				  'field3');	
		})
	$('#castSkill4').click(function () {
		storeData('skill4', JSON.stringify(document.querySelector('#amount4').value));
		amountOfSkill = getAmountOfSkill('field4'); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field4.API, 
				  skills[user.stats.class].field4.name,
				  skills[user.stats.class].field4.cost,
				  skills[user.stats.class].field4.wardrobe,
				  skills[user.stats.class].field4.nameOfWardrobe, 
				  'field4');	
		})
	$('#rememberGear').click(function(){	
		rememberGear = JSON.stringify($('#rememberGear').is(":checked")); 
		storeData("Remember Gear", rememberGear);
		})
		


    //////////////////////////////////////////////////////////////////////
    ////   Display the HTML    (within paseData)   ///////////////////////
    //////////////////////////////////////////////////////////////////////
	$('#documentationAndForm').html(' ');
    $('#modal').hide();
    $('#output').html(htmlStart + html + htmlEnd);
	prepareSkillAmounts();
	
} // End of parseData() and its nested functions
}); // end of global Function

</script>
<style>

/*********************************************************************
****   Page-wide   ***************************************************
*********************************************************************/

body {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 14px;
    background-color: #4f2a93;
	color: #000000;
}

#outerFrame {
	margin: 0px;
	background-color: #4f2a93;
}

#innerBody {
    margin: 5px;
    padding: 5px; 
    background-color: #eeeeee;
	color: #000000;
	border-radius: 8px;
}

#loading {
    margin-right: 30px;
    margin-left: 30px;
    color: orange;
    font-size: 1.5em;
    font-weight: bold;
}

div.scroll {
    width: 95%;
    height: 200px;
    overflow: scroll;
}


#userNameDisplay {
    text-align: right;
    font-weight: bold;
    font-size: 1.5em;
    margin-bottom: 5px;
}
#headerExtras .showHideToggle {
    white-space: nowrap;
}
#explanationAndClearLinks span {
    padding-left: 10px;
}

.show {
    display: block;
}

.hide {
    display: none;
}

.clear {
    clear: both;
}

.wardrobes-Container {
  display: flex;
  flex-wrap: wrap;
  background-color: #dddddd;
  line-height: 250px;
  border-radius: 8px;

}

.wardrobes-Container>div {
  background-color: #eeeeee;
  border-radius: 8px;
  width:280px;
  margin: 10px;
  border: 10px;
  text-align: left;

  line-height: 13px;
  font-size: 12px;
}

.skills-Container {
  display: flex;
  flex-wrap: wrap;
  background-color: #dddddd;
  line-height: 250px;
  border-radius: 8px;

}

.skills-Container>div {
  background-color: #eeeeee;
  border-radius: 8px;
  width:280px;
  margin: 10px;
  border: 10px;
  text-align: center;

  line-height: 13px;
  font-size: 12px;
}

.flex-displayContent {
	background-color: #eeeeee;
	display: flex;
	flex-wrap: wrap;
	margin: 10%
	width: 100%;
	height: 200px;
	overflow: scroll;

}
.flex-displayContent>div {
	width: 50%;
	margin: 10px;
	border: 10px;
	text-align: left;
	overflow:scroll;
}
/***************************
******Attriute Containers **
****************************/
.container {
    width: 97%;
    height: 80px;
    color: #4e4a57;
    margin: auto;
    padding: 0;
	border-radius: 8px;
}
.one {
    width: 47%;
    height: 70px;
	float: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff
	
}
.two {
	width: 47%;
    margin-left: 50%;
    height: 70px;
	align: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff


}

.innerContainer {
    width: 100%;
    height: 70px;
    background: #ffffff;
    margin: auto;
    padding: 0px;
	color: #4e4a57;
	font-family: "Roboto",sans-serif;
	
}
.innerOne {
	text-transform: uppercase;
	text-align: center;
	vertical-align: 5px;
	font-size: large;
    width: 45%;
    height: 70px;
    background: #ffffff;
	color: #4e4a57;
	float: left;
	

}
.innerTwo {
	font-size: x-small;
    margin-left: 45%;
    height: 70px;
    background: #ffffff;
	color: #4e4a57;

}

.containerMana {
    border-radius: 8px;
	width: 92%;
    height: 110px;
    color: #4e4a57;
    margin: auto;
    padding: 8px;
	background: #efffff;
	font-family: "Roboto",sans-serif;
}

.left {
    width: 58%;
    
	float: left;
}

.middle {
	width: 20%;
	text-align: right;
	float: left;
}
.right {
	width: 18%;
    margin-left: 76%;
	text-align: right;
	align: left;
}


.skills {
    width: 47%;
    height: 80px;
	float: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff
	
}
.mana {
	width: 47%;
    margin-left: 50%;
    height: 80px;
	align: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff


}




/***************************
*** IMG hovers *************
***************************/
.wrap {
  position: relative;
}

.description {
  border-radius: 8px;
  position: absolute;
  bottom: 5px;
  left: 1px;
  font-weight: normal;
  color: #333333;
  visibility: invisible;
  opacity: 0;
  background-color: #fefefe;
  margin: auto;
  padding: 5px;
  border: 1px solid #888888;
  width: 130px;
  z-index: 2;
}
.descriptionStats {
  border-radius: 8px;
  position: absolute;
  top: 5px;
  left: 90px;
  right: 50px;
  font-weight: normal;
  color: #333333;
  visibility: invisible;
  opacity: 0;
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888888;
  width: 150px;
  z-index: 2;
}
.descriptionSkills {
  border-radius: 8px;
  position: absolute;
  bottom: 30px;
  left: -8px;
  font-weight: normal;
  color: #333333;
  visibility: invisible;
  opacity: 0;
  background-color: #fefefe;
  margin: auto;
  padding: 0px;
  border: 1px solid #888888;
  width: 280px;
  z-index: 2;
}

.wrap:hover .description {
  visibility: visible;
  opacity: 1;
}

.wrap:hover .descriptionStats {
  visibility: visible;
  opacity: 1;
}

.wrap:hover .descriptionSkills {
  visibility: visible;
  opacity: 1;
}

/*******************
Toggle Wardrobes/Skills
********************/

#wardrobes-Container {
  width: 100%;
  padding: 50px 0;
  text-align: center;
  background-color: lightblue;
  margin-top: 20px;
  display: block; 
}
#skill-Container {
  width: 100%;
  padding: 50px 0;
  text-align: center;
  background-color: blue;
  margin-top: 20px;
  display: none;
  }


/***********************************
quantity buttons
***************/
.number {
	width: 20px; 
}

.value-button {
  display: inline-block;
  border: 1px solid #ddd;
  margin: 0px;
  width: 40px;
  height: 20px;
  text-align: center;
  vertical-align: middle;
  padding: 11px 0;
  background: #eee;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.value-button:hover {
  cursor: pointer;
}

form #decrease {
  margin-right: -4px;
  border-radius: 8px 0 0 8px;
}

form #increase {
  margin-left: -4px;
  border-radius: 0 8px 8px 0;
}

form #input-wrap {
  margin: 0px;
  padding: 0px;
}

input#number {
  text-align: center;
  border: none;
  border-top: 1px solid #ddd;
  border-bottom: 1px solid #ddd;
  margin: 0px;
  width: 40px;
  height: 40px;
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/*********************************
Mana bars
************************************/
.manaContainer {
  width: 100%;
  background-color: #271b3d;
  color: #ffffff;
  font-size: 1.0em;

}

.manaBar {
  position: relative;
  line-height: 20px;
  height: 20px;



}
.manaText {
  position: absolute; z-index:1;
  text-align: right;
  padding-left: 10px;
  color: #d5c8ff;
  font-size: 0.8em;
	}

.current {width: 80%; background-color: #50b5e9;}
.cron {width: 95%; background-color: #50b5e9;}
.cap {width: 5%; background-color: #f74e52;}

/**********************************************************************
****** Modal **********************************************************
**********************************************************************/
/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 4; /* Sit on top */
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
	width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
	position: absolute; 
	left: 50%;
	top: 32%;
	transform: translate(-50%, -50%);
	border-radius: 8px;
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 300px;
	font-weight: bold;
	text-align: center; 
}


/* The Modal (background) */
.modalData {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 3; /* Sit on top, even on top of Tooltips*/
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
	width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modalData-content {
	position: fixed;
    bottom: 10%;
    right: 10%;
    width: 80%;
    height: 80%;
	overflow: scroll; 
	border-radius: 8px;
    background-color: #fefefe;
    border: 2px solid #eeeeee;
	z-index: 4; 
}




/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.fixedTop {
	position: fixed;
	overflow: none; 
}

/*********************************************************************
****   Header   ******************************************************
*********************************************************************/

h1 {
    float: left;
	font-size: 1.5em;
}

h1>a:first-child { /* "Habitica" link in header */
    color: black;
    text-decoration: none;
}

h1>a:first-child:hover { /* "Habitica" link in header */
    text-decoration: underline;
}

h1 span {
    font-size: 0.5em;
}




/************************************************
***** top navigation ****************************
************************************************/

body {
  font-family: Arial, Helvetica, sans-serif;
}

.navbar {
  overflow: hidden;
  background-color: #eeeeee;
}

.navbar a {
  float: left;
  font-size: 16px;
  color: 662266;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}

.navbar b {
  float: left;
  font-size: 16px;
  color: #662266;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;	
}



.dropdown {
  float: left;
  overflow: hidden;
}

.dropdown .dropbtn {
  font-size: 16px;  
  border: none;
  outline: none;
  color: #662266;
  padding: 14px 16px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}

.navbar a:hover, .dropdown:hover .dropbtn {
  background-color: #662266;
  color: white; 
}


.topnav-right {
  float: right;
}

.small {
	font-size: 8px;
	margin: 1px; 
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 3;
}

.dropdown-content a {
  float: none;
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.dropdown-content a:hover {
  background-color: #ddd;
}

.dropdown:hover .dropdown-content {
  display: block;
}

</style>

</head>


<body>
<!-- Modal -->
<div id="modal" class="modal">
  	<!-- Modal content -->
  	<div id="modalContent" class="modal-content"></div>
</div>	
<div id="modalData" class="modalData">	
	<div id="modalDataContent" class="modalData-content"></div>
</div>
<div id="modalSettings" class="modalData">	
	<div id="modalSettingsContent" class="modalData-content">
		<a>Settings: 
			<span class="close">&times;</span>
		</a>
		<a> Hard mode:<input id="hardMode" type="checkbox" autocomplete="off"></a>
		
	</div>
</div>


<!-- end Modal -->

<div id="innerBody">

<h1>Habitican Wardrobes<br>
	<span>(v 2.0 July 2019)</span></h1>
<div id="headerExtras"></div>
<hr class="clear" />
<div id="loading">
    <div class="good hide">
        <p>Please wait. Syncronizing with Habitica server...</p>
    </div>
    <div class="bad hide">
        <p>There was an error obtaining the data.</p>
        <ul class="padded">
            <li>Please reload the page (but perhaps wait half an hour first in case Habitica is under heavy load).</li>
            <li>If you're using Internet Explorer, try another browser. <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a> or <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a> will be more reliable.</li>
        </ul>
    </div>
</div>

<div id="userStats"></div>

<hr class="clear" />

<div id="buttons"></div>

<hr class="clear" />


<div id="documentationAndForm">
    <iframe src="null.htm" id="formPasswdSaveFix" name="formPasswdSaveFix" style="display:none"></iframe><!-- DAMN YOU CHROME!! DAMN YOU!!!! http://stackoverflow.com/a/9116737 -->
    <form id="userApiDetailsForm" method="POST" action="" target="formPasswdSaveFix">
        <fieldset>
            <legend><span class="highlight">Enter your Habitica API details</span>
            (from <a href="https://habitica.com/user/settings/api" target="_blank"> User Icon &gt; Settings &gt; API</a>)
            </legend>
            <label for="userId"><span>User ID</span>
                <input type="text" name="userId" id="userId" value=""> <!-- Value entfernen -->
            </label>
            <label for="apiToken"><span>API Token</span>
                <input type="password" name="apiToken" id="apiToken" value=""> <!-- Value entfernen -->
            </label>

            <input type="submit" value="Fetch My Data" />
			<p style="font-size: 8px;">
			Datenschutzerklärung und Impressum:
			<br>
			Verantwortlicher: ABB Allgemeine Buchhaltungshilfe- und Betriebsberatungsges. mbH, Hammer Deich 70, 20537 Hamburg<br>
			<br>
			Personenbezogene Daten: Die Angaben zu User-ID und API-Token (habitica.com) werden nicht durch abbhh.de gespeichert und dienen ausschließlich 
			dem Zugriff auf habitica.com. abbhh.de speichert Serverlogfiles (IP-Adresse, verwendeter Browser, Referer-Url). Die Erhebung der Daten dient dem Betrieb der 
			Website. Die Daten werden nicht ausgewertet und nach 30 	Tagen gelöscht. abbhh.de/wardrobes.html wird auf Ihrem Browser ausgeführt und speichet dort vom Benutzer 
			ausgewählte Einstellungen im LocalStorage oder alternativ als Cookie auf Ihrem Gerät. Diese Datenspeicherung erfolgt ausschließlich für die Komfortoptimierung der Benutzer.<br>
			<br>
			Widerspruch gegen die Datenverarbeitung und Zustimmung zur Datenverarbeitung.  						
			Durch Eingabe Ihrer Nutzerdaten User-ID und API-Token akzeptieren Sie die Erhebung o.g. Daten. Der Datenerhebung widersprechen Sie durch Verzicht auf die Nutzung 
			dieser Website. 
			<br><br>
            Privacy and security notes:
            <br>
			Personal Data / Contact: <br>
			Responsible Person: ABB Allgemeine Buchhaltungshilfe- und Betriebsberatungsges. mbH, Hammer Deich 70, 20537 Hamburg / Germany
			<br><br>
			Personal data: The information on user ID and API tokens (habitica.com) are not stored abbhh.de and are used exclusively
			accessing habitica.com. abbhh.de stores server log files (IP address, browser used, referer url). The collection of data serves the operation of
			Website. The data will not be evaluated and will be deleted after 30 days. abbhh.de/wardrobes.html is executed on your browser and stores the user
			selected settings in the LocalStorage or alternatively as a cookie on your device. This data storage is exclusively done for the comfort of the users. 
			<br>
			Opposition to data processing and consent to data processing.
			By entering your user data User-ID and API-Token you accept the survey of the data mentioned above. Contradict the data collection by waiving the use
			this website.
			<br><br>General<br>			  
            Your API Token is a password - do not share it with anyone, not even the maintainer of this page if you are seeking help.<br>
            This page does not save your User ID and API Token to any location, but your browser might, if it has been configured to
            save form and password information. If you are using this page on a shared computer, you should clear any data that the browser
            has saved.
            <br>This page will make changes to your Habitica accout. It changes equipped gear. If anything goes wrong, you will probably be
			be able to change everything back using the official access paths (webpage, app).
            <br>Changes to the Habitica user data made on this webpage will take effect immediately on the official webpage or on the app. Visibility of changes 
			occur after a sync there. 
			<br>This page is not Habitica code. It's third party. Autor is @Piti (user of Habitica and member of the guild 'Aspiring Comrades' and 'Habitican Wardrobes').</li>
			</p>
        </fieldset>
    </form>
</div><!-- end of div id="documentationAndForm" -->

<div id="modalVersion" class="modalData">	
	<div id="modalVersionContent" class="modalData-content">
	<span class="close">&times;</span>
   Verions Info: <br><br>
   Version 2.0<br>
   <li>You can now toggle the display between Wardrobes and Skills. </li>
   <li>The new Skills-section allows you to cast any of your four skills with an adjustable number of repititions.</li>
   <li>Values (repititions, Hard-Mode, selcted FrontEnd) are stored either in your browsers Local-Storage or in a local cookie if there is no Local-Storage 
   (if you use Edge as browser e.g.). All values will still be present after a page reload or a complete browser restart. Check any search-engine on how to 
   clean local Storage to delete entries by hand. </li>
   <li>Amount of repitition will automatically be reduced if Mana-level is too low.</li>
   <li>Skills cannot be cast if your level is too low for the specific skill. </li>
   <li>The website uses the best suitable wardrobe for your chosen skill and returns to wardrobe Intelligence when all skills are completed. <br>
   Plans are to let you specify a wardrobe to return to. </li>
   <li>Skills that are cast on tasks will be cast on your bluest task (highest positive value). <br>
   Warriors who might want to make a red tast more blue, will unfortunately have to wait for a future version where they can choose an individual target.<br>
   It is not possible to cast skills on tasks from challenges. </li>
   <li>Some buttons were relocated to a new navigation bar on the top of the page for easier access and better looks. </li>
   <li>Display of information about gear, user-data, Habitica-content, tasks, etc. now uses modals for an optimized field of view. </li>
   <li>The API section needed major adjustments and was redsigned completely. <br>
   The use of deferred promises could no longer be maintained and had to be replaced by async await functions in order to sequentially go through the chain of ajax-calls. </li>
   <li>xhr-headers for server-requests now contain the name of the tool and the authors user-id.</li>
   <li>There are wait-functions between API-Server-Calls to minimize server-load. <br>
   The more skills are cast, the longer the waiting time between calls will be. The formula is (1000+(1000 * amount / (0.01 * amount + 20))) in milli-seconds. So code 
   waits 1.5 sec each on 10 casts, 3.5 sec each on 50 casts and 11 sec each on 200 casts. </li> 
   <li>Adjustments of some z-index</li>
   <li>Adjustments of disclaimer for legal compatibility with local law in conjunction with data-processing</li><br>
   <br> 
   
   Version 1.4<br>
   Hard Mode - button added. Default value is disabled - showing gear with compromise in some cases. <br>
   Activating Hard Mode will provide best gear at any cost. <br><br>
   Version 1.3.5<br>
   Tooltips added for Skills in order to give more precise information. <br>
   Refresh-button moved to top of the page for accessability. <br>
   Counters added to "lodading" and "equipping" modals. <br>
   <br>
   Version 1.3<br>
   Class-specific Impacts of skills were added for all classes.<br>
   This version allows for entry level players<br>
   Bug-fixes: <br>
   Empty inventory sports are no longer shown. <br>
   In case multiple wardrobes contain the same inventory, all those wardrobes are displayed with a boarder. <br>
   Corrected focus for Tooltips for information about gear <br> 
   undefined situations in gear fixed<br>
   euip-function was adjusted to match exact number of items in each wardrobe<br>
   <br>
   Version 1.2<br>
   Two-handed weapons were implemented.  <br>
   code was overhauled. <br>
   <br>
   <br>
   old Version 1.1<br>
  Fixed bug:  Items that were lost due to death were suggested in the wardrobe, and couldn't be equipped. 
   
   </div>
  


</div>

</div><!-- end of div id="outerFrame" -->
</body>

</html>
